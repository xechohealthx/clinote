<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clinote</title>
  <link href="popup.css" rel="stylesheet">
</head>
<body>
  <div class="popup-container">
    <header class="popup-header">
      <div class="logo">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14.828 14.828a4 4 0 0 1-5.656 0M9 10h1m4 0h1m-6.5-7h7a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-4a.5.5 0 0 1 .5-.5z"/>
        </svg>
        <h1>Clinote</h1>
      </div>
      <div class="version">v1.0.0</div>
    </header>

    <div class="popup-content">
      <!-- Privacy Notice -->
      <div class="privacy-notice">
        <div class="privacy-icon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
            <circle cx="12" cy="16" r="1"/>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
          </svg>
        </div>
        <div class="privacy-text">
          <strong>HIPAA-Aware Design</strong>
          <p>No patient data is stored unless explicitly enabled. All processing can be done locally.</p>
        </div>
      </div>

      <!-- Main Action Section -->
      <div class="section">
        <h2>Quick Actions</h2>
        <div class="quick-actions">
          <button id="start-transcription" class="action-btn primary large">
            üé§ Start Recording
          </button>
          <button id="stop-transcription" class="action-btn secondary large" disabled>
            ‚èπÔ∏è Stop Recording
          </button>
        </div>
        <div class="session-actions">
          <button id="new-session" class="action-btn tertiary">
            üë• New Patient Session
          </button>
        </div>
        <div class="status-text" id="status-text">Ready to record</div>
      </div>

      <!-- Settings Toggle -->
      <div class="section">
        <button id="settings-toggle" class="settings-toggle">
          ‚öôÔ∏è Settings
        </button>
      </div>

      <!-- Settings Panel (Hidden by default) -->
      <div id="settings-panel" class="settings-panel" style="display: none;">
        <!-- Processing Mode -->
        <div class="section">
          <h2>Processing Mode</h2>
          <div class="mode-selector">
            <label class="radio-option">
              <input type="radio" name="processing-mode" value="local">
              <div class="radio-content">
                <div class="radio-title">Local Processing</div>
                <div class="radio-description">Process audio locally for maximum privacy</div>
              </div>
            </label>
            <label class="radio-option">
              <input type="radio" name="processing-mode" value="cloud" checked>
              <div class="radio-content">
                <div class="radio-title">Cloud Processing</div>
                <div class="radio-description">Use OpenAI services for better accuracy</div>
              </div>
            </label>
          </div>

          <!-- API Key Input (shown when cloud mode is selected) -->
          <div id="api-key-section" class="api-key-section">
            <label for="api-key">OpenAI API Key</label>
            <input type="password" id="api-key" placeholder="sk-...">
            <div class="help-text">
              Your API key is stored locally and never shared.
              <a href="https://platform.openai.com/api-keys" target="_blank">Get your API key</a>
            </div>
          </div>

          <!-- Local Mode Info (shown when local mode is selected) -->
          <div id="local-mode-section" class="local-mode-section" style="display: none;">
            <div class="local-mode-info">
              <div class="info-icon">üîí</div>
              <div class="info-content">
                <h4>Local Processing</h4>
                <p>Audio is processed entirely on your device for maximum privacy and HIPAA compliance.</p>
                <div class="server-status" id="server-status">
                  <span class="status-indicator" id="status-indicator">‚óè</span>
                  <span class="status-text" id="status-text">Checking server status...</span>
                </div>
                <button id="download-installer" class="download-btn">
                  üì• Download Whisper Server
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Specialty Templates -->
        <div class="section">
          <h2>Specialty Template</h2>
          <select id="specialty-select" class="specialty-select">
            <option value="primary-care">Primary Care</option>
            <option value="psychiatry">Psychiatry</option>
            <option value="cardiology">Cardiology</option>
            <option value="dermatology">Dermatology</option>
            <option value="pediatrics">Pediatrics</option>
            <option value="orthopedics">Orthopedics</option>
            <option value="neurology">Neurology</option>
            <option value="emergency-medicine">Emergency Medicine</option>
          </select>
        </div>

        <!-- Settings -->
        <div class="section">
          <h2>Settings</h2>
          <div class="settings-list">
            <label class="setting-item">
              <input type="checkbox" id="auto-insert">
              <div class="setting-content">
                <div class="setting-title">Auto-insert summaries</div>
                <div class="setting-description">Automatically insert generated notes into active text fields</div>
              </div>
            </label>
            
            <label class="setting-item">
              <input type="checkbox" id="save-transcripts">
              <div class="setting-content">
                <div class="setting-title">Save anonymized transcripts</div>
                <div class="setting-description">Store transcripts locally for quality assurance (no PHI)</div>
              </div>
            </label>
          </div>
        </div>

        <!-- Summary Sections -->
        <div class="section">
          <h2>Summary Sections</h2>
          <div class="section-description">Choose which sections to include when inserting into EMR:</div>
          <div class="settings-list">
            <label class="setting-item">
              <input type="checkbox" id="include-chief-complaint" checked>
              <div class="setting-content">
                <div class="setting-title">Chief Complaint</div>
                <div class="setting-description">Primary reason for visit</div>
              </div>
            </label>
            
            <label class="setting-item">
              <input type="checkbox" id="include-hpi" checked>
              <div class="setting-content">
                <div class="setting-title">History of Present Illness</div>
                <div class="setting-description">Detailed symptom history and patient quotes</div>
              </div>
            </label>
            
            <label class="setting-item">
              <input type="checkbox" id="include-ros" checked>
              <div class="setting-content">
                <div class="setting-title">Review of Systems</div>
                <div class="setting-description">Systematic review of body systems</div>
              </div>
            </label>
            
            <label class="setting-item">
              <input type="checkbox" id="include-assessment" checked>
              <div class="setting-content">
                <div class="setting-title">Assessment</div>
                <div class="setting-description">Clinical diagnosis and reasoning</div>
              </div>
            </label>
            
            <label class="setting-item">
              <input type="checkbox" id="include-plan" checked>
              <div class="setting-content">
                <div class="setting-title">Treatment Plan</div>
                <div class="setting-description">Interventions, medications, and follow-up</div>
              </div>
            </label>
            
            <label class="setting-item">
              <input type="checkbox" id="include-medications" checked>
              <div class="setting-content">
                <div class="setting-title">Medications</div>
                <div class="setting-description">Current and new prescriptions</div>
              </div>
            </label>
            
            <label class="setting-item">
              <input type="checkbox" id="include-followup" checked>
              <div class="setting-content">
                <div class="setting-title">Follow-up</div>
                <div class="setting-description">Timeline and monitoring instructions</div>
              </div>
            </label>
            
            <label class="setting-item">
              <input type="checkbox" id="include-diagnosis-codes" checked>
              <div class="setting-content">
                <div class="setting-title">Diagnosis Codes</div>
                <div class="setting-description">ICD-10 codes with descriptions</div>
              </div>
            </label>
            
            <label class="setting-item">
              <input type="checkbox" id="include-cpt-codes" checked>
              <div class="setting-content">
                <div class="setting-title">CPT Codes</div>
                <div class="setting-description">Procedure codes with descriptions</div>
              </div>
            </label>
          </div>
        </div>

        <!-- Privacy Consent -->
        <div class="section">
          <div class="consent-notice">
            <label class="setting-item">
              <input type="checkbox" id="privacy-consent" required>
              <div class="setting-content">
                <div class="setting-title">Privacy Acknowledgment</div>
                <div class="setting-description">
                  I understand that this tool processes audio from medical consultations and will use appropriate safeguards to protect patient privacy.
                </div>
              </div>
            </label>
          </div>
        </div>

        <footer class="popup-footer">
          <button id="save-settings" class="save-btn">Save Settings</button>
        </footer>
      </div>
    </div>
  </div>

  <!-- Consent Modal -->
  <div id="consent-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Patient Consent Required</h3>
      </div>
      <div class="modal-body">
        <div class="consent-warning">
          <div class="warning-icon">‚ö†Ô∏è</div>
          <div class="warning-text">
            <strong>Legal Compliance Notice:</strong><br>
            Audio recording requires explicit patient consent under state wiretap laws and HIPAA requirements.
          </div>
        </div>
        
        <div class="consent-statement">
          <p><strong>By clicking "Start Recording", I confirm:</strong></p>
          <ul>
            <li>I have obtained explicit patient consent to record this session</li>
            <li>I have explained the purpose and scope of recording to the patient</li>
            <li>The patient has provided informed consent for audio analysis</li>
            <li>I will maintain patient privacy and confidentiality</li>
            <li>I understand this recording is for clinical documentation only</li>
          </ul>
        </div>
        
        <div class="consent-checkbox">
          <label>
            <input type="checkbox" id="explicit-consent">
            <span>I confirm I have patient consent to record and analyze this session using Clinote</span>
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button id="consent-cancel" class="btn-secondary">Cancel</button>
        <button id="consent-start" class="btn-primary" disabled>Start Recording</button>
      </div>
    </div>
  </div>

  <script src="popup.js"></script>
</body>
</html>